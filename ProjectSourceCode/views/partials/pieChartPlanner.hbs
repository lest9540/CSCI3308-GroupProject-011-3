<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            text-align: center;
        }
        
        .pieChart {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: lightgray;
            border: 1px solid;
            border-color: rgb(107, 107, 107);
            margin: auto;
            background-color: gray;
        }

        .buttonContainer{
            margin-bottom: 50px;
        }

    </style>
</head>
<body>
    <!--Title and Description-->
    <div>
        <h3>Make your own piechart</h3>
        <p>Customize and modify a plan for your spending</p>
    </div>

    <!--Piechart Visuals-->
    <div class = "pieChart">
        
    </div>

    <!-- Button trigger modal -->
    <div class="buttonContainer">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#pieChartModal"> Customize Piechart </button>
    </div>

    <!-- Piechart Modal -->
    <div class="modal fade" id="pieChartModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <!--Modal Header-->
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Modal title</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!--Modal Body-->
                <div class="modal-body">
                    <form id = "pieChartCategories">
                        <div class="mb-3">
                            <label for="pieChartCategory1" class="form-label">Category 1</label>
                            <input type="number" class="form-control" id="category1Percentage" placeholder="Enter percentage">
                            <input type="color" class="form-control form-control-color" id="category1Color" value="#e74e4e" title="Choose your color">
                        </div>

                        <div class="mb-3">
                            <label for="pieChartCategory2" class="form-label">Category 2</label>
                            <input type="number" class="form-control" id="category2Percentage" placeholder="Enter percentage">
                            <input type="color" class="form-control form-control-color" id="category2Color" value="#f68849" title="Choose your color">
                        </div>

                        <div class="mb-3">
                            <label for="pieChartCategory3" class="form-label">Category 3</label>
                            <input type="number" class="form-control" id="category3Percentage" placeholder="Enter percentage">
                            <input type="color" class="form-control form-control-color" id="category3Color" value="#70ed78" title="Choose your color">
                        </div>

                        <div class="mb-3">
                            <label for="pieChartCategory4" class="form-label">Category 4</label>
                            <input type="number" class="form-control" id="category4Percentage" placeholder="Enter percentage">
                            <input type="color" class="form-control form-control-color" id="category4Color" value="#4881ed" title="Choose your color">
                        </div>
                    </form>
                </div>

                <!--Modal Footer-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="updatePlannerPieChart()" data-bs-dismiss="modal">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!--__________________________________________________________________________________________________________________________________________-->
    <!--Script-->
     <script>
 
         // Updating Piechart function
         function updatePieChart(){
             // Storing percantages of each category in a list
             const percentageList = [
                 parseFloat(document.getElementById("category1Percentage").value) || 0,
                 parseFloat(document.getElementById("category2Percentage").value) || 0,
                 parseFloat(document.getElementById("category3Percentage").value) || 0,
                 parseFloat(document.getElementById("category4Percentage").value) || 0,
             ];
 
             // Storing the colors for each category
             const colorList = [
                 document.getElementById("category1Color").value || 0,
                 document.getElementById("category2Color").value || 0,
                 document.getElementById("category3Color").value || 0,
                 document.getElementById("category4Color").value || 0,
             ];
 
             // Checking total percent values to make sure its between 0 and 100
             // NOTE: Using Principles of Programming concepts, 'let' is used to just set the scope to here
             let total = 0;
             for(let listPercentValue of percentageList) {
                 total += listPercentValue;
             }
 
             if(total > 100 || total == 0){
                 return
             }
 
             // Storing data as local
             localStorage.setItem("plannerPieChartData", JSON.stringify({
                 percentageListData: percentageList,
                 colorListData: colorList
             }));
 
             // For loop to fill in the gradient
             let gradientCommands = "";
             let percentAccumulator = 0;
             let percentageListLength = percentageList.length;
 
             for(let i = 0; i < percentageListLength; i++){
                 let start = (percentAccumulator / total) * 100;
                 percentAccumulator += percentageList[i]
                 let end = (percentAccumulator / total) * 100;
 
                 // Concats commands into a single variable
                 gradientCommands += `${colorList[i]} ${start}% ${end}%,`;
             }
 
             // Updating .piechart conic gradient
             document.querySelector(".pieChart").style.background = `conic-gradient(${gradientCommands.slice(0, -1)})`;
         }
 
 
         // Function for loading piechart data
         document.addEventListener("DOMContentLoaded", function(){
 
             let storedPieChartData = localStorage.getItem("plannerPieChartData")
 
             if(storedPieChartData !== null)
             {
                 // Parsing the stored data
                 let extractedData = JSON.parse(storedPieChartData);
                 
                 document.getElementById("category1Percentage").value = extractedData.percentageListData[0] || 0;
                 document.getElementById("category2Percentage").value = extractedData.percentageListData[1] || 0;
                 document.getElementById("category3Percentage").value = extractedData.percentageListData[2] || 0;
                 document.getElementById("category4Percentage").value = extractedData.percentageListData[3] || 0;
 
                 document.getElementById("category1Color").value = extractedData.colorListData[0] || 0;
                 document.getElementById("category2Color").value = extractedData.colorListData[1] || 0;
                 document.getElementById("category3Color").value = extractedData.colorListData[2] || 0;
                 document.getElementById("category4Color").value = extractedData.colorListData[3] || 0;
 
                 updatePieChart();
                 
             }
         });
 
     </script>

</body>
</html>
